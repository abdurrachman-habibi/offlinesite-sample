!function(){var t=angular.module("app",["ngTouch","ngMaterial","ngRoute","LocalStorageModule"]);t.run(["$route","Auth",function(t,o){o.fillAuthData()}]),t.config(["$httpProvider","$routeProvider","routes",function(t,o,e){t.interceptors.push("authInterceptorService"),e.forEach(function(t){o.when(t.url,t.configuration)}),o.otherwise({redirectTo:"/"})}]);var o=[{url:"/",configuration:{templateUrl:"templates/home.html"}},{url:"/login",configuration:{templateUrl:"templates/login.html"}}];t.constant("routes",o)}();
!function(){function n(n,t,o,a){o.items=a.queryLocal(),a.query().then(function(n){n&&t.show(t.alert().title("Data Baru").content("Data baru tersedia. Halaman akan dimuat ulang").ok("Ok")).then(function(){o.items=n})},function(o){401==o&&t.show(t.alert().title("Login is required").content("New data can only be checked once you logged in").ok("Ok")).then(function(){n.path("/login")})})}function t(n,t,o,a){function e(){a.login(o.loginData).then(function(){n.path("/")},function(){t.show(t.alert().title("Error Login").content("Connection Problem or Invalid Login Data. Please try again").ok("Ok"))})}o.loginData={username:"",password:""},o.login=e}var o=angular.module("app");o.controller("HomeCtrl",n),n.$inject=["$location","$mdDialog","$scope","Item"],o.controller("AccountCtrl",t),t.$inject=["$location","$mdDialog","$scope","Auth"]}();
!function(){function e(e,t,r){function n(){return r.get("Item")}function a(e){r.set("Item",e)}function u(){return n()}function i(){function r(e){var t=e,r=JSON.stringify(t),o=n();return o&&r==JSON.stringify(o)?!1:(a(t),!0)}var i=t.defer();if(s)i.resolve();else{var c=o+"api/values";e.get(c).success(function(e){s=e,r(s)?i.resolve(u()):i.resolve()}).error(function(e,t){401==t&&a([]),i.reject(t)})}return i.promise}var s,c={};return c.query=i,c.queryLocal=u,c}function t(e,t,r){return this.request=function(e){e.headers=e.headers||{};var t=r.get("authorizationData");return t&&(e.headers.Authorization="Bearer "+t.token),e},this.responseError=function(r){if(401===r.status){var n=e.get("Auth");n.logout()}return t.reject(r)},this}function r(e,t,r){function n(){return r.get("authorizationData")}function a(e){r.set("authorizationData",e)}function u(){return r.remove("authorizationData")}function i(){var e=n();e&&(f.isAuth=!0,f.userName=e.userName)}function s(r){var n="grant_type=password&username="+r.userName+"&password="+r.password,u=t.defer();return e.post(o+"token",n,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){a({token:e.access_token,userName:r.userName}),f.isAuth=!0,u.resolve(e)}).error(function(e){c(),u.reject(e)}),u.promise}function c(){u(),f.isAuth=!1,f.userName=""}var f={},h={};return h.fillAuthData=i,h.login=s,h.logout=c,h}var n=angular.module("app"),o="http://mydemo-api.azurewebsites.net/";n.factory("Item",e),e.$inject=["$http","$q","localStorageService"],n.factory("authInterceptorService",t),t.$inject=["$injector","$q","localStorageService"],n.factory("Auth",r),r.$inject=["$http","$q","localStorageService"]}();